<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SDTS-3 Tools</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <!-- Sidebar Menu -->
    <aside class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <div class="sidebar-logo">
                <span class="logo-icon">üõ†Ô∏è</span>
                <h2>SDTS-3 Tools</h2>
            </div>
            <button class="sidebar-toggle" id="sidebarToggle" title="Recolher menu">
                <span class="toggle-icon">‚ò∞</span>
            </button>
        </div>
        <nav class="sidebar-nav">
            <ul class="nav-list">
                <li class="nav-item">
                    <a href="#" class="nav-link active" data-module="criador-oficio">
                        <span class="nav-icon">üìÑ</span>
                        <span class="nav-text">Criador de Of√≠cio</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#" class="nav-link" data-module="gerador-trello">
                        <span class="nav-icon">üìã</span>
                        <span class="nav-text">Gerador de Trello</span>
                    </a>
                </li>
            </ul>
        </nav>
        <div class="sidebar-footer">
            <p>v1.0.0</p>
            <p>¬© 2025 CBMMG</p>
        </div>
    </aside>

    <!-- Main Content Area -->
    <div class="main-wrapper" id="mainWrapper">
        <!-- Top Header Bar -->
        <header class="top-header">
            <button class="menu-toggle" id="menuToggle" title="Abrir menu">
                <span>‚ò∞</span>
            </button>
            <div class="header-content">
                <h1 id="moduleTitle">üî• Criador de Of√≠cios SEI</h1>
                <p id="moduleDescription">Sistema automatizado de cria√ß√£o de of√≠cios com IA</p>
            </div>
        </header>

        <!-- Module: Criador de Of√≠cio -->
        <div class="module-container" id="module-criador-oficio">
            <div class="container">
                <main>
                    <div class="tipo-selector">
                        <select 
                            id="tipo_doc" 
                            name="tipo_doc"
                            required
                            class="tipo-select"
                        >
                            <option value="" selected disabled>Selecione o tipo...</option>
                            <option value="NTS">Criador</option>
                            <option value="NTS">Resposta</option>
                        </select>
                    </div>
                    
                    <form id="oficioForm">
                        <div class="form-grid">
                            <div class="form-group">
                                <label for="doc_sei">
                                <span class="label-icon">üìÑ</span>
                                Documento SEI
                                </label>
                                <input 
                                    type="text" 
                                    id="doc_sei" 
                                    name="doc_sei" 
                                    placeholder="Ex: 126086248"
                                    required
                                >
                            </div>
                        <div class="form-group">
                            <label for="processo">
                                <span class="label-icon">üìã</span>
                                N√∫mero do Processo
                            </label>
                            <input 
                                type="text" 
                                id="processo" 
                                name="processo" 
                                placeholder="Ex: 1400.01.0074829/2025-05"
                                required
                            >
                        </div>
                        <div class="form-group">
                            <label for="processo">
                                <span class="label-icon">üîç</span>
                                Of√≠cio de Refer√™ncia
                            </label>
                            <input 
                                type="text" 
                                id="ofreferencia" 
                                name="ofreferencia" 
                                placeholder="Ex: Of√≠cio 388 (126102548)"
                                required
                            >
                        </div>
                    <div class="form-group full-width">
                        <label for="assunto">
                            <span class="label-icon">üìù</span>
                            Assunto
                        </label>
                        <input 
                            type="text" 
                            id="assunto" 
                            name="assunto" 
                            placeholder="Ex: Resposta quanto a esclarecimentos adicionais"
                            required
                        >
                    </div>

                    <div class="form-group full-width">
                        <label for="complementar">
                            <span class="label-icon">üí°</span>
                            Complemento para IA (opcional)
                            <span class="label-hint">Instru√ß√µes adicionais para gera√ß√£o da resposta</span>
                        </label>
                        <textarea 
                            id="complementar" 
                            name="complementar" 
                            rows="2"
                            placeholder="Ex: Seja mais formal, mencione a legisla√ß√£o vigente, etc."
                        ></textarea>
                    </div>

                    <div class="form-group full-width">
                        <label for="destinatario">
                            <span class="label-icon">üë§</span>
                            Destinat√°rio
                        </label>
                        <input 
                            type="text" 
                            id="destinatario" 
                            name="destinatario" 
                            placeholder="Ex: Senhor Ten Cel BM, Resp p/ pelo 5¬∫COB"
                            required
                        >
                    </div>

                    <div class="form-group">
                        <label for="signatario">
                            <span class="label-icon">‚úçÔ∏è</span>
                            Signat√°rio
                        </label>
                        <select 
                            id="signatario" 
                            name="signatario"
                            required
                        >
                            <option value="">Selecione o signat√°rio...</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="graduacao">
                            <span class="label-icon">üéñÔ∏è</span>
                            Gradua√ß√£o
                        </label>
                        <input 
                            type="text" 
                            id="graduacao" 
                            name="graduacao" 
                            placeholder="Ex: Cel BM"
                            readonly
                            required
                        >
                    </div>
                    <!-- Adicione dentro do form-grid, ap√≥s o campo de Of√≠cio de Refer√™ncia -->
                    <div class="form-group">
                        <label for="has_ticket">
                            <span class="label-icon">üé´</span>
                            Possui Seletor?
                        </label>
                        <select 
                            id="has_ticket" 
                            name="has_ticket"
                            required
                        >
                            <option value="" disabled selected>Selecione uma op√ß√£o...</option>
                            <option value="sim">Sim</option>
                            <option value="nao">N√£o</option>
                        </select>
                    </div>

                    <div class="form-group full-width">
                        <label for="funcao">
                            <span class="label-icon">üíº</span>
                            Fun√ß√£o
                        </label>
                        <input 
                            type="text" 
                            id="funcao" 
                            name="funcao" 
                            placeholder="Ex: Diretora de Log√≠stica e Finan√ßas"
                            readonly
                            required
                        >
                    </div>
                </div>

                <!-- Se√ß√£o de Marca√ß√£o e Atribui√ß√£o -->
                <div class="section-header">
                    <h3>üìå Marca√ß√£o e Atribui√ß√£o</h3>
                    <p class="section-description">Configure a etiqueta e atribui√ß√£o do processo</p>
                </div>

                <div class="form-grid">
                    <div class="form-group full-width">
                        <label for="etiqueta">
                            <span class="label-icon">üè∑Ô∏è</span>
                            Etiqueta
                        </label>
                        <select 
                            id="etiqueta" 
                            name="etiqueta"
                            required
                        >
                            <option value="Aguardando Despacho Diretor">Aguardando Despacho Diretor</option>
                            <option value="Aguardando Despacho do Major" selected>Aguardando Despacho do Major</option>
                            <option value="Aguardando Despacho do SDTS">Aguardando Despacho do SDTS</option>
                            <option value="Divulga√ß√£o Geral">Divulga√ß√£o Geral</option>
                            <option value="NTS">NTS</option>
                            <option value="Prioridade - Urgente">Prioridade - Urgente</option>
                        </select>
                    </div>

                    <div class="form-group full-width">
                        <label for="atribuicao">
                            <span class="label-icon">üë•</span>
                            Atribuir Para
                        </label>
                        <select 
                            id="atribuicao" 
                            name="atribuicao"
                            required
                        >
                        <option value="Cel Stella">Cel Stella</option>
                        <option value="Ten Cel Montezano">Ten Cel Montezano</option>
                        <option value="Maj Vicente">Maj Vicente</option>
                        <option value="Maj Rocha" selected>Maj Rocha</option>
                        <option value="Maj Couto">Maj Couto</option>
                        <option value="Maj Giovanny">Maj Giovanny</option>
                        <option value="Cap Linke">Cap Linke</option>
                        <option value="Cap Alexandre">Cap Alexandre</option>
                        <option value="Sgt Dam√°sio">Sgt Dam√°sio</option>
                        <option value="Sgt Sandro">Sgt Sandro</option>
                        <option value="Ten Cesar Alves">Ten Cesar Alves</option>
                        <option value="Ten Paiva">Ten Paiva</option>
                        </select>
                    </div>

                    <div class="form-group full-width">
                        <label for="msg">
                            <span class="label-icon">üí¨</span>
                            Mensagem da Anota√ß√£o
                            <button type="button" class="btn-helper" id="btnGerarMsg" title="Gerar mensagem automaticamente">
                                ‚ú® Gerar Despacho
                            </button>
                        </label>
                        <textarea 
                            id="msg" 
                            name="msg" 
                            rows="3"
                            placeholder="Digite a mensagem que ser√° adicionada como anota√ß√£o no processo..."
                            required
                        ></textarea>
                        <span class="char-counter" id="charCounter">0/250 caracteres</span>
                    </div>

                    <!-- Gerador de Despacho (oculto por padr√£o) -->
                    <div id="despachoGenerator" class="despacho-generator hidden">
                        <h4>üìã Gerador de Despacho</h4>
                        
                        <div class="form-group">
                            <label>Complemento (opcional)</label>
                            <input type="text" id="complemento" placeholder="Digite o complemento (opcional)">
                        </div>

                        <div class="form-grid" style="grid-template-columns: auto 1fr auto; align-items: end;">
                            <div class="form-group">
                                <label>Artigo</label>
                                <select id="artigo">
                                    <option value="o">o</option>
                                    <option value="a">a</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>Nome do Documento</label>
                                <input type="text" id="nomeDocumento" placeholder="Ex: Of√≠cio n¬∫ 123/2025">
                            </div>
                            <div class="form-group">
                                <button type="button" class="btn-add-doc" id="btnAddDoc">+</button>
                            </div>
                        </div>
                        <div id="listaDocumentos" class="lista-docs"></div>
                        <div id="alertDespacho" class="alert-despacho hidden"></div>
                        <button type="button" class="btn-gerar" id="btnGerarTexto">‚ú® Gerar Texto</button>
                    </div>
                </div>

                        <div class="button-group">
                            <button type="submit" id="submitBtn" class="btn btn-primary">
                                <span class="btn-icon">üöÄ</span>
                                Criar Of√≠cio
                            </button>
                            <button type="button" id="clearBtn" class="btn btn-secondary">
                                <span class="btn-icon">üîÑ</span>
                                Limpar
                            </button>
                            <button type="button" id="planBtn" class="btn btn-warning" onclick="window.open('https://docs.google.com/spreadsheets/d/1Le3Wzd1_4yHWCTtgHJeAEN8Qm82EkeT8TJGH_AoM8ho/edit?usp=sharing', '_blank')">
                                <span class="btn-icon">üìä</span>
                                Planilha
                            </button>
                        </div>
                    </form>

                    <div id="statusContainer" class="status-container hidden">
                        <div class="status-header">
                            <h2>üìä Status do Processo</h2>
                            <button id="closeStatus" class="close-btn">‚úï</button>
                        </div>
                        <div id="statusLog" class="status-log"></div>
                        <div class="progress-bar">
                            <div id="progressFill" class="progress-fill">
                                <span id="progressText" class="progress-text">0%</span>
                            </div>
                        </div>
                    </div>
                </main>
            </div>
        </div>
        <!-- End Module: Criador de Of√≠cio -->

        <!-- Module: Gerador de Trello -->
        <div class="module-container hidden" id="module-gerador-trello">
            <div class="container">
                <main>
                    <form id="trelloForm">
                        <!-- Board e Label -->
                        <div class="form-grid">
                            <div class="form-group">
                                <label for="board_name">
                                    <span class="label-icon">üìã</span>
                                    Nome do Board
                                </label>
                                <input 
                                    type="text" 
                                    id="board_name" 
                                    name="board_name" 
                                    placeholder="Ex: SDTS-3 - Projetos 2025"
                                    value="Desenvolvimento de Sistemas"
                                    required
                                >
                            </div>

                            <div class="form-group">
                                <label for="label_select">
                                    <span class="label-icon">üè∑Ô∏è</span>
                                    Label
                                    <button type="button" class="btn-helper" id="btnManageLabels" title="Gerenciar labels">
                                        ‚öôÔ∏è Gerenciar
                                    </button>
                                </label>
                                <select 
                                    id="label_select" 
                                    name="label_select"
                                    required
                                >
                                    <option value="">Selecione um label...</option>
                                </select>
                            </div>
                        </div>

                        <!-- T√≠tulo -->
                        <div class="form-group full-width">
                            <label for="card_title">
                                <span class="label-icon">üìå</span>
                                T√≠tulo do Card
                                <label class="checkbox-label">
                                    <input type="checkbox" id="auto_title" name="auto_title">
                                    <span>Gerar automaticamente com IA</span>
                                </label>
                            </label>
                            <input 
                                type="text" 
                                id="card_title" 
                                name="card_title" 
                                placeholder="Ex: Sistema de Controle de Protocolos"
                            >
                        </div>

                        <!-- Descri√ß√£o -->
                        <div class="form-group full-width">
                            <label for="card_description">
                                <span class="label-icon">üìù</span>
                                Descri√ß√£o
                                <span class="label-hint">Ser√° formatada automaticamente pela IA</span>
                            </label>
                            <textarea 
                                id="card_description" 
                                name="card_description" 
                                rows="8"
                                placeholder="Descreva o projeto, funcionalidades, objetivos, etc. A IA ir√° estruturar e detalhar automaticamente..."
                                required
                            ></textarea>
                        </div>

                        <!-- List e Data -->
                        <div class="form-grid">
                            <div class="form-group">
                                <label for="list_name">
                                    <span class="label-icon">üìë</span>
                                    Nome da Lista
                                </label>
                                <input 
                                    type="text" 
                                    id="list_name" 
                                    name="list_name" 
                                    placeholder="Ex: Backlog, Em Desenvolvimento, Conclu√≠do"
                                    value="Em desenvolvimento"
                                    required
                                >
                            </div>

                            <div class="form-group">
                                <label for="due_date">
                                    <span class="label-icon">üìÖ</span>
                                    Data de Vencimento (opcional)
                                </label>
                                <input 
                                    type="date" 
                                    id="due_date" 
                                    name="due_date"
                                >
                            </div>
                        </div>

                        <div class="button-group">
                            <button type="submit" id="submitTrelloBtn" class="btn btn-primary">
                                <span class="btn-icon">üöÄ</span>
                                Criar Card no Trello
                            </button>
                            <button type="button" id="clearTrelloBtn" class="btn btn-secondary">
                                <span class="btn-icon">üîÑ</span>
                                Limpar
                            </button>
                        </div>
                    </form>

                    <!-- Status Container -->
                    <div id="trelloStatusContainer" class="status-container hidden">
                        <div class="status-header">
                            <h2>üìä Status da Cria√ß√£o</h2>
                            <button id="closeTrelloStatus" class="close-btn">‚úï</button>
                        </div>
                        <div id="trelloStatusLog" class="status-log"></div>
                        <div class="progress-bar">
                            <div id="trelloProgressFill" class="progress-fill">
                                <span id="trelloProgressText" class="progress-text">0%</span>
                            </div>
                        </div>
                    </div>
                </main>
            </div>
        </div>
        <!-- End Module: Gerador de Trello -->

        <!-- Modal: Gerenciar Labels -->
        <div class="modal" id="labelModal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2>üè∑Ô∏è Gerenciar Labels</h2>
                    <button class="close-btn" id="closeLabelModal">‚úï</button>
                </div>
                <div class="modal-body">
                    <div class="label-form">
                        <h3>Adicionar Novo Label</h3>
                        <div class="form-grid">
                            <div class="form-group">
                                <label for="new_label_name">Nome do Label</label>
                                <input 
                                    type="text" 
                                    id="new_label_name" 
                                    placeholder="Ex: Urgente"
                                >
                            </div>
                            <div class="form-group">
                                <label for="new_label_color">Cor</label>
                                <select id="new_label_color">
                                    <option value="red">üî¥ Vermelho</option>
                                    <option value="orange">üü† Laranja</option>
                                    <option value="yellow">üü° Amarelo</option>
                                    <option value="green">üü¢ Verde</option>
                                    <option value="blue">üîµ Azul</option>
                                    <option value="purple">üü£ Roxo</option>
                                    <option value="pink">ü©∑ Rosa</option>
                                    <option value="sky">üî∑ Azul Claro</option>
                                    <option value="lime">üü© Verde Lim√£o</option>
                                    <option value="black">‚ö´ Preto</option>
                                </select>
                            </div>
                        </div>
                        <button type="button" class="btn btn-primary" id="addLabelBtn">
                            <span class="btn-icon">‚ûï</span>
                            Adicionar Label
                        </button>
                    </div>

                    <div class="labels-list">
                        <h3>Labels Cadastrados</h3>
                        <div id="labelsList"></div>
                    </div>
                </div>
            </div>
        </div>

        <footer class="main-footer">
            <p>¬© 2025 CBMMG - SDTS-3 Tools</p>
        </footer>
    </div>

    <script>
        // Carregar dados dos militares e popular o select de signat√°rio
        let dadosMilitares = {};
        
        fetch('/dadosmil.json')
            .then(response => response.json())
            .then(data => {
                dadosMilitares = data;
                const signatarioSelect = document.getElementById('signatario');
                
                // Popular o select com os nomes dos militares
                Object.entries(data).forEach(([cpf, dados]) => {
                    const option = document.createElement('option');
                    option.value = cpf;
                    // Se o cpf for igual a 04962692674 deve ser marcado como selected
                    if (cpf === '04962692674') {
                        option.selected = true;
                    }
                    option.textContent = dados[0]; // Nome completo (posi√ß√£o 0)
                    signatarioSelect.appendChild(option);
                });
            })
            .catch(error => console.error('Erro ao carregar dados dos militares:', error));
        
        // Evento de mudan√ßa do signat√°rio
        document.getElementById('signatario').addEventListener('change', function() {
            const cpf = this.value;
            if (cpf && dadosMilitares[cpf]) {
                const dados = dadosMilitares[cpf];
                // Posi√ß√£o 5 = Gradua√ß√£o (√≠ndice 5)
                document.getElementById('graduacao').value = dados[5] || '';
                // Posi√ß√£o 6 = Fun√ß√£o (√≠ndice 6)
                document.getElementById('funcao').value = dados[6] || '';
            } else {
                document.getElementById('graduacao').value = '';
                document.getElementById('funcao').value = '';
            }
        });

        // ============= SIDEBAR NAVIGATION =============
        const sidebar = document.getElementById('sidebar');
        const mainWrapper = document.getElementById('mainWrapper');
        const sidebarToggle = document.getElementById('sidebarToggle');
        const menuToggle = document.getElementById('menuToggle');
        const navLinks = document.querySelectorAll('.nav-link:not(.disabled)');
        const moduleTitle = document.getElementById('moduleTitle');
        const moduleDescription = document.getElementById('moduleDescription');

        // Module configurations
        const moduleConfigs = {
            'criador-oficio': {
                title: 'üî• Criador de Of√≠cios SEI',
                description: 'Sistema automatizado de cria√ß√£o de of√≠cios com IA'
            },
            'gerador-trello': {
                title: 'üìã Gerador de Trello',
                description: 'Gera√ß√£o autom√°tica de cards do Trello'
            }
        };

        // Toggle sidebar
        function toggleSidebar() {
            sidebar.classList.toggle('collapsed');
            mainWrapper.classList.toggle('expanded');
        }

        // Toggle sidebar on mobile
        function toggleMobileSidebar() {
            sidebar.classList.toggle('mobile-open');
        }

        if (sidebarToggle) {
            sidebarToggle.addEventListener('click', toggleSidebar);
        }

        if (menuToggle) {
            menuToggle.addEventListener('click', toggleMobileSidebar);
        }

        // Switch between modules
        navLinks.forEach(link => {
            link.addEventListener('click', function(e) {
                e.preventDefault();
                
                const moduleName = this.getAttribute('data-module');
                
                // Update active state
                navLinks.forEach(l => l.classList.remove('active'));
                this.classList.add('active');
                
                // Hide all modules
                document.querySelectorAll('.module-container').forEach(m => {
                    m.classList.add('hidden');
                });
                
                // Show selected module
                const moduleElement = document.getElementById('module-' + moduleName);
                if (moduleElement) {
                    moduleElement.classList.remove('hidden');
                }
                
                // Update header
                if (moduleConfigs[moduleName]) {
                    moduleTitle.textContent = moduleConfigs[moduleName].title;
                    moduleDescription.textContent = moduleConfigs[moduleName].description;
                }
                
                // Close mobile sidebar
                sidebar.classList.remove('mobile-open');
            });
        });

        // Close sidebar when clicking outside on mobile
        document.addEventListener('click', function(e) {
            if (window.innerWidth <= 768) {
                if (!sidebar.contains(e.target) && !menuToggle.contains(e.target)) {
                    sidebar.classList.remove('mobile-open');
                }
            }
        });
    </script>
    <script src="script.js"></script>
    <script src="trello.js"></script>
</body>
</html>
